<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>BarberCoin Pay</title>
  <style>
    body { font-family: -apple-system, system-ui, Arial; margin:0; background:#0b0b0f; color:#fff; }
    .wrap { max-width:420px; margin:0 auto; padding:24px; }
    .card { background:#151523; border:1px solid #26263a; border-radius:16px; padding:18px; }
    h1 { margin:0 0 8px; font-size:28px; }
    p { margin:0 0 16px; opacity:.85; }
    input { width:100%; padding:14px; border-radius:12px; border:1px solid #2b2b44; background:#0f0f1a; color:#fff; font-size:16px; }
    button { width:100%; padding:14px; border-radius:12px; border:none; margin-top:12px; background:#2f6bff; color:#fff; font-size:16px; font-weight:700; }
    button:disabled { opacity:.6; }
    .msg { margin-top:12px; font-size:14px; opacity:.9; }
    .err { color:#ff6b6b; }
    .ok  { color:#58ffb0; }
    .tiny { margin-top:18px; font-size:12px; opacity:.65; }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>BarberCoin Pay</h1>
    <p>Enter an amount and generate a checkout link from the BarberCoin backend.</p>

    <div class="card">
      <label>Amount (USD)</label>
      <input id="amt" inputmode="numeric" placeholder="60" value="60" />
      <button id="payBtn">Pay Now</button>
      <div id="msg" class="msg"></div>
      <div class="tiny">Backend: <span id="base"></span></div>
    </div>
  </div>

<script>
  const BASE_URL = "https://usbarber-backend.onrender.com";
  document.getElementById("base").textContent = BASE_URL;

  const msg = (text, cls="") => {
    const el = document.getElementById("msg");
    el.className = "msg " + cls;
    el.textContent = text;
  };

  document.getElementById("payBtn").onclick = async () => {
    msg("");
    const btn = document.getElementById("payBtn");
    btn.disabled = true;

    try {
      const dollars = parseInt(document.getElementById("amt").value || "0", 10);
      if (!dollars || dollars <= 0) { msg("Enter a valid amount (ex: 60).", "err"); return; }

      msg("Creating checkout…", "");
      const body = {
        amount_cents: dollars * 100,
        currency: "usd",
        description: "US Barber Test Haircut",
        success_url: "https://google.com",
        cancel_url: "https://google.com"
      };

      const r = await fetch(`${BASE_URL}/payments/checkout`, {
        method: "POST",
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify(body)
      });

      const data = await r.json().catch(() => ({}));
      if (!r.ok) throw new Error(JSON.stringify(data));

      if (!data.checkout_url) throw new Error("Missing checkout_url from server.");
      msg("Opening checkout…", "ok");
      window.location.href = data.checkout_url;
    } catch (e) {
      msg("Error: " + (e.message || e), "err");
    } finally {
      btn.disabled = false;
    }
  };
</script>
</body>
</html>
