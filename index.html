<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>BarberCoin Pay</title>

  <style>
    body { font-family: system-ui, -apple-system, Arial; background:#0b1020; color:#fff; display:flex; min-height:100vh; align-items:center; justify-content:center; padding:24px; }
    .card { width:100%; max-width:420px; background:#121a33; border:1px solid #24305a; border-radius:14px; padding:18px; }
    h1 { margin:0 0 8px; font-size:22px; }
    p { margin:0 0 14px; opacity:.85; }
    input { width:100%; padding:12px; border-radius:10px; border:1px solid #2b3a6b; background:#0e1630; color:#fff; font-size:16px; box-sizing:border-box; }
    button { width:100%; margin-top:12px; padding:12px; border-radius:10px; border:0; background:#2f6bff; color:#fff; font-size:16px; font-weight:700; cursor:pointer; }
    button:disabled { opacity:.6; cursor:not-allowed; }
    .small { margin-top:12px; font-size:12px; opacity:.7; }
    .status { margin-top:10px; font-size:13px; opacity:.9; }
  </style>
</head>

<body>
  <div class="card">
    <h1>BarberCoin Pay</h1>
    <p>Enter an amount to generate a Stripe checkout link.</p>

    <label for="amount">Amount (USD)</label>
    <input id="amount" type="number" inputmode="decimal" placeholder="5" />

    <button id="payNow">Pay Now</button>

    <div id="status" class="status"></div>
    <div class="small" id="backendText"></div>
  </div>

  <script>
    // âœ… This is your live backend on Render:
    const BASE_URL = "https://usbarber-backend.onrender.com";

    const amountInput = document.getElementById("amount");
    const btn = document.getElementById("payNow");
    const statusEl = document.getElementById("status");
    const backendText = document.getElementById("backendText");

    backendText.textContent = "Backend: " + BASE_URL;

    function setStatus(msg) { statusEl.textContent = msg; }

    btn.addEventListener("click", async () => {
      const dollars = Number(amountInput.value);

      if (!dollars || dollars <= 0) {
        setStatus("Enter a valid amount.");
        return;
      }

      const amount_cents = Math.round(dollars * 100);

      // Redirect back to GitHub Pages (success/cancel)
      const basePath = window.location.pathname.endsWith("/")
        ? window.location.pathname
        : window.location.pathname.replace(/\/[^/]*$/, "/");

      const success_url = `${window.location.origin}${basePath}success.html`;
      const cancel_url  = `${window.location.origin}${basePath}cancel.html`;

      btn.disabled = true;
      setStatus("Creating checkout...");

      try {
        const res = await fetch(`${BASE_URL}/payments/checkout`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            amount_cents,
            currency: "usd",
            description: "BarberCoin Pay",
            success_url,
            cancel_url
          })
        });

        const data = await res.json();

        if (!res.ok) throw new Error(data.error || "Checkout failed");
        if (!data.checkout_url) throw new Error("Missing checkout_url");

        setStatus("Opening checkout...");
        window.location.href = data.checkout_url;

      } catch (err) {
        setStatus("Error: " + err.message);
        btn.disabled = false;
      }
    });
  </script>
</body>
</html>
